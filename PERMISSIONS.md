# Há»‡ Thá»‘ng PhÃ¢n Quyá»n - RoomMaster

## CÃ¡c Role vÃ  Quyá»n Háº¡n

### 1. ğŸ‘‘ ADMIN (Quáº£n trá»‹ viÃªn)
**Quyá»n cao nháº¥t - Quáº£n lÃ½ toÃ n há»‡ thá»‘ng**

#### ÄÆ°á»£c phÃ©p:
- âœ… Táº¥t cáº£ quyá»n cá»§a Manager
- âœ… **Quáº£n lÃ½ nhÃ¢n viÃªn** (Users)
  - ThÃªm nhÃ¢n viÃªn má»›i
  - Sá»­a thÃ´ng tin nhÃ¢n viÃªn
  - XÃ³a nhÃ¢n viÃªn
  - Thay Ä‘á»•i role
- âœ… **XÃ³a dá»¯ liá»‡u quan trá»ng**
  - XÃ³a phÃ²ng
  - XÃ³a khÃ¡ch thuÃª
  - XÃ³a hÃ³a Ä‘Æ¡n (chá»‰ hÃ³a Ä‘Æ¡n chÆ°a thanh toÃ¡n)

#### Menu hiá»ƒn thá»‹:
- Dashboard
- PhÃ²ng (+ nÃºt ThÃªm phÃ²ng, Edit, Delete)
- KhÃ¡ch thuÃª (+ nÃºt ThÃªm, Edit, Checkout, Delete)
- HÃ³a Ä‘Æ¡n (+ nÃºt Táº¡o má»›i, Táº¡o hÃ ng loáº¡t, Edit, Thanh toÃ¡n)
- BÃ¡o cÃ¡o
- **NhÃ¢n viÃªn** (chá»‰ Admin)

---

### 2. ğŸ“‹ MANAGER (Quáº£n lÃ½)
**Quáº£n lÃ½ váº­n hÃ nh hÃ ng ngÃ y**

#### ÄÆ°á»£c phÃ©p:
- âœ… **Xem táº¥t cáº£ dá»¯ liá»‡u**
- âœ… **Quáº£n lÃ½ phÃ²ng**
  - ThÃªm phÃ²ng má»›i
  - Sá»­a thÃ´ng tin phÃ²ng
  - Thay Ä‘á»•i tráº¡ng thÃ¡i phÃ²ng
- âœ… **Quáº£n lÃ½ khÃ¡ch thuÃª**
  - ThÃªm khÃ¡ch thuÃª má»›i
  - Sá»­a thÃ´ng tin khÃ¡ch
  - ÄÃ¡nh dáº¥u chuyá»ƒn Ä‘i
- âœ… **Quáº£n lÃ½ hÃ³a Ä‘Æ¡n**
  - Táº¡o hÃ³a Ä‘Æ¡n Ä‘Æ¡n láº»
  - Táº¡o hÃ³a Ä‘Æ¡n hÃ ng loáº¡t
  - Sá»­a hÃ³a Ä‘Æ¡n (chÆ°a thanh toÃ¡n)
  - Ghi nháº­n thanh toÃ¡n
- âœ… **Xem bÃ¡o cÃ¡o**

#### KhÃ´ng Ä‘Æ°á»£c phÃ©p:
- âŒ Quáº£n lÃ½ nhÃ¢n viÃªn
- âŒ XÃ³a phÃ²ng
- âŒ XÃ³a khÃ¡ch thuÃª
- âŒ XÃ³a hÃ³a Ä‘Æ¡n

#### Menu hiá»ƒn thá»‹:
- Dashboard (+ nÃºt ThÃªm phÃ²ng, ThÃªm khÃ¡ch, Táº¡o hÃ³a Ä‘Æ¡n)
- PhÃ²ng (+ nÃºt ThÃªm, Edit | âŒ Delete)
- KhÃ¡ch thuÃª (+ nÃºt ThÃªm, Edit, Checkout | âŒ Delete)
- HÃ³a Ä‘Æ¡n (+ nÃºt Táº¡o má»›i, Táº¡o hÃ ng loáº¡t, Edit, Thanh toÃ¡n)
- BÃ¡o cÃ¡o

---

### 3. ğŸ‘€ VIEWER (Chá»‰ xem)
**Chá»‰ Ä‘Æ°á»£c xem dá»¯ liá»‡u, khÃ´ng thay Ä‘á»•i**

#### ÄÆ°á»£c phÃ©p:
- âœ… Xem Dashboard
- âœ… Xem danh sÃ¡ch phÃ²ng
- âœ… Xem chi tiáº¿t phÃ²ng
- âœ… Xem danh sÃ¡ch khÃ¡ch thuÃª
- âœ… Xem chi tiáº¿t khÃ¡ch thuÃª
- âœ… Xem danh sÃ¡ch hÃ³a Ä‘Æ¡n
- âœ… Xem chi tiáº¿t hÃ³a Ä‘Æ¡n
- âœ… Xem bÃ¡o cÃ¡o

#### KhÃ´ng Ä‘Æ°á»£c phÃ©p:
- âŒ ThÃªm/Sá»­a/XÃ³a báº¥t ká»³ dá»¯ liá»‡u nÃ o
- âŒ Táº¡o hÃ³a Ä‘Æ¡n
- âŒ Ghi nháº­n thanh toÃ¡n
- âŒ Thay Ä‘á»•i tráº¡ng thÃ¡i phÃ²ng/khÃ¡ch

#### Menu hiá»ƒn thá»‹:
- Dashboard (âŒ KhÃ´ng cÃ³ nÃºt Thao tÃ¡c nhanh)
- PhÃ²ng (âŒ KhÃ´ng cÃ³ nÃºt ThÃªm/Edit/Delete)
- KhÃ¡ch thuÃª (âŒ KhÃ´ng cÃ³ nÃºt ThÃªm/Edit/Checkout/Delete)
- HÃ³a Ä‘Æ¡n (âŒ KhÃ´ng cÃ³ nÃºt Táº¡o/Edit/Thanh toÃ¡n)
- BÃ¡o cÃ¡o

---

## Chi Tiáº¿t PhÃ¢n Quyá»n Theo Chá»©c NÄƒng

### PhÃ²ng (Rooms)
| Chá»©c nÄƒng | Admin | Manager | Viewer |
|-----------|-------|---------|--------|
| Xem danh sÃ¡ch | âœ… | âœ… | âœ… |
| Xem chi tiáº¿t | âœ… | âœ… | âœ… |
| ThÃªm phÃ²ng | âœ… | âœ… | âŒ |
| Sá»­a phÃ²ng | âœ… | âœ… | âŒ |
| XÃ³a phÃ²ng | âœ… | âŒ | âŒ |

### KhÃ¡ch thuÃª (Tenants)
| Chá»©c nÄƒng | Admin | Manager | Viewer |
|-----------|-------|---------|--------|
| Xem danh sÃ¡ch | âœ… | âœ… | âœ… |
| Xem chi tiáº¿t | âœ… | âœ… | âœ… |
| ThÃªm khÃ¡ch | âœ… | âœ… | âŒ |
| Sá»­a thÃ´ng tin | âœ… | âœ… | âŒ |
| ÄÃ¡nh dáº¥u chuyá»ƒn Ä‘i | âœ… | âœ… | âŒ |
| XÃ³a khÃ¡ch | âœ… | âŒ | âŒ |

### HÃ³a Ä‘Æ¡n (Invoices)
| Chá»©c nÄƒng | Admin | Manager | Viewer |
|-----------|-------|---------|--------|
| Xem danh sÃ¡ch | âœ… | âœ… | âœ… |
| Xem chi tiáº¿t | âœ… | âœ… | âœ… |
| Táº¡o hÃ³a Ä‘Æ¡n | âœ… | âœ… | âŒ |
| Táº¡o hÃ ng loáº¡t | âœ… | âœ… | âŒ |
| Sá»­a hÃ³a Ä‘Æ¡n | âœ… | âœ… | âŒ |
| Ghi nháº­n thanh toÃ¡n | âœ… | âœ… | âŒ |
| XÃ³a hÃ³a Ä‘Æ¡n | âœ… | âŒ | âŒ |

### BÃ¡o cÃ¡o (Reports)
| Chá»©c nÄƒng | Admin | Manager | Viewer |
|-----------|-------|---------|--------|
| Doanh thu | âœ… | âœ… | âœ… |
| CÃ´ng suáº¥t | âœ… | âœ… | âœ… |
| KhÃ¡ch thuÃª | âœ… | âœ… | âœ… |
| QuÃ¡ háº¡n | âœ… | âœ… | âœ… |

### NhÃ¢n viÃªn (Users)
| Chá»©c nÄƒng | Admin | Manager | Viewer |
|-----------|-------|---------|--------|
| Xem danh sÃ¡ch | âœ… | âŒ | âŒ |
| ThÃªm nhÃ¢n viÃªn | âœ… | âŒ | âŒ |
| Sá»­a nhÃ¢n viÃªn | âœ… | âŒ | âŒ |
| XÃ³a nhÃ¢n viÃªn | âœ… | âŒ | âŒ |

---

## CÃ¡ch Kiá»ƒm Tra Quyá»n Trong Template

### Sá»­ dá»¥ng Jinja2 Condition:

```jinja2
{# Chá»‰ Admin #}
{% if current_user.role == 'admin' %}
    <button>XÃ³a</button>
{% endif %}

{# Admin hoáº·c Manager #}
{% if current_user.role in ['admin', 'manager'] %}
    <button>Sá»­a</button>
{% endif %}

{# Viewer khÃ´ng tháº¥y gÃ¬ #}
{% if current_user.role in ['admin', 'manager'] %}
    <a href="{{ url_for('rooms.add_room') }}" class="btn btn-primary">
        ThÃªm phÃ²ng
    </a>
{% endif %}
```

---

## CÃ¡ch Kiá»ƒm Tra Quyá»n Trong Routes (Backend)

### Sá»­ dá»¥ng Decorators:

```python
from app.decorators import admin_required, manager_or_admin

# Chá»‰ Admin
@bp.route('/delete/<int:id>', methods=['POST'])
@admin_required
def delete_user(id):
    # ...
    pass

# Admin hoáº·c Manager
@bp.route('/create', methods=['GET', 'POST'])
@manager_or_admin
def create_invoice():
    # ...
    pass
```

---

## TÃ i Khoáº£n Máº·c Äá»‹nh

Sau khi cháº¡y `seed_data.py`:

| Username | Password | Role | MÃ´ táº£ |
|----------|----------|------|-------|
| admin | admin123 | admin | TÃ i khoáº£n quáº£n trá»‹ viÃªn |
| manager | manager123 | manager | TÃ i khoáº£n quáº£n lÃ½ |
| viewer | viewer123 | viewer | TÃ i khoáº£n chá»‰ xem |

---

## LÆ°u Ã Báº£o Máº­t

1. âœ… **Backend protection**: Táº¥t cáº£ routes Ä‘á»u cÃ³ decorator kiá»ƒm tra quyá»n
2. âœ… **Frontend hiding**: NÃºt/link sáº½ áº©n náº¿u khÃ´ng cÃ³ quyá»n
3. âœ… **Káº¿t há»£p 2 lá»›p**: Ngay cáº£ khi bypass frontend, backend váº«n cháº·n
4. âœ… **Flash message**: Hiá»ƒn thá»‹ thÃ´ng bÃ¡o rÃµ rÃ ng khi khÃ´ng cÃ³ quyá»n
5. âœ… **HTTP 403**: Tráº£ vá» Forbidden náº¿u cá»‘ truy cáº­p khÃ´ng há»£p lá»‡

---

## Cáº­p Nháº­t Log

**NgÃ y 05/11/2025**
- âœ… ÄÃ£ áº©n táº¥t cáº£ nÃºt thÃªm/sá»­a/xÃ³a vá»›i Viewer
- âœ… ÄÃ£ áº©n nÃºt xÃ³a vá»›i Manager
- âœ… ÄÃ£ áº©n menu NhÃ¢n viÃªn vá»›i Manager/Viewer
- âœ… Dashboard: áº¨n "Thao tÃ¡c nhanh" vá»›i Viewer
- âœ… Táº¥t cáº£ danh sÃ¡ch: áº¨n nÃºt action theo role
- âœ… Trang chi tiáº¿t: áº¨n nÃºt sá»­a/xÃ³a theo role
- âœ… HÃ³a Ä‘Æ¡n: áº¨n nÃºt thanh toÃ¡n vá»›i Viewer

---

**ğŸ¯ Má»¥c tiÃªu**: Há»‡ thá»‘ng phÃ¢n quyá»n rÃµ rÃ ng, an toÃ n, dá»… má»Ÿ rá»™ng
